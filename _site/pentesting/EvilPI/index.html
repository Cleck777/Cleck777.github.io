<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>EvilPI: Using a Raspberry Pi as an Agent into an Internal Network -</title>
<meta name="description" content="Ever thought of using a Raspberry Pi as an agent for pentesting within an internal network? In this project, we explore how to set up a lightweight tool called Ligolo-ng on a Raspberry Pi. By routing through a cloud instance, you can leverage your at-home Kali machine for effective penetration testing. This guide walks you through the steps of setting up the agent and proxy, establishing secure SSH tunnels, and configuring your devices for seamless connectivity. Perfect for anyone looking to expand their pentesting toolkit with a cost-effective and portable solution.">


  <meta name="author" content="CLECK">
  
  <meta property="article:author" content="CLECK">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="">
<meta property="og:title" content="EvilPI: Using a Raspberry Pi as an Agent into an Internal Network">
<meta property="og:url" content="/pentesting/EvilPI/">


  <meta property="og:description" content="Ever thought of using a Raspberry Pi as an agent for pentesting within an internal network? In this project, we explore how to set up a lightweight tool called Ligolo-ng on a Raspberry Pi. By routing through a cloud instance, you can leverage your at-home Kali machine for effective penetration testing. This guide walks you through the steps of setting up the agent and proxy, establishing secure SSH tunnels, and configuring your devices for seamless connectivity. Perfect for anyone looking to expand their pentesting toolkit with a cost-effective and portable solution.">



  <meta property="og:image" content="/assets/images/evilpi.png">





  <meta property="article:published_time" content="2024-06-24T00:00:00-04:00">





  

  


<link rel="canonical" href="/pentesting/EvilPI/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/"
                
                
              >Home</a>
            </li><li class="masthead__menu-item">
              <a
                href="/year-archive/"
                
                
              >Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="/">
        <img src="/assets/images/penguin.png" alt="CLECK" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="/" itemprop="url">CLECK</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Pentester, CTF Player</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">US</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="EvilPI: Using a Raspberry Pi as an Agent into an Internal Network">
    <meta itemprop="description" content="Ever thought of using a Raspberry Pi as an agent for pentesting within an internal network? In this project, we explore how to set up a lightweight tool called Ligolo-ng on a Raspberry Pi. By routing through a cloud instance, you can leverage your at-home Kali machine for effective penetration testing. This guide walks you through the steps of setting up the agent and proxy, establishing secure SSH tunnels, and configuring your devices for seamless connectivity. Perfect for anyone looking to expand their pentesting toolkit with a cost-effective and portable solution.">
    <meta itemprop="datePublished" content="2024-06-24T00:00:00-04:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="/pentesting/EvilPI/" itemprop="url">EvilPI: Using a Raspberry Pi as an Agent into an Internal Network
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><img src="/assets/images/evilpi.png#center" alt="" /></p>

<h2 id="background">Background</h2>

<p>While doing some of the Pro-labs for HTB, I recently discovered <a href="https://github.com/Nicocha30/ligolo-ng">ligolo-ng</a>.</p>

<blockquote>
  <p><strong>Ligolo-ng</strong> is a <em>simple</em>, <em>lightweight</em>, and <em>fast</em> tool that allows pentesters to establish tunnels from a reverse TCP/TLS connection using a <strong>tun interface</strong> (without the need for SOCKS).</p>
</blockquote>

<p>The program is really cool and easy to use. It allows you to tunnel into the infected device similar to a VPN. This allows attackers to get around tools like ProxyChains and can help speed up tools like Nmap.</p>

<p>I thought it might be a neat little project to get a lightweight tool like this one running on a Raspberry Pi. We can then route through a cloud instance and use our at-home Kali machine.</p>

<p>This would be useful if you needed to put a machine on an internal network for pentesting.</p>

<h2 id="getting-started">Getting Started</h2>

<p>In this project, I will be using a <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry Pi 4</a> (4GB) running Debian and a Linode container.</p>

<p>Ligolo-ng is built using an agent and a proxy. For the Raspberry Pi, you will want to pick up a copy of the agent:
https://github.com/nicocha30/ligolo-ng/releases/tag/v0.6.1</p>

<h2 id="testing-on-pi">Testing on Pi</h2>

<p>Iâ€™m going to pick up a copy for my Pi by running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget https://github.com/nicocha30/ligolo-ng/releases/download/v0.6.1/ligolo-ng_agent_0.6.1_linux_armv7.tar.gz
$ tar xf ./ligolo-ng_agent_0.6.1_linux_armv7.tar.gz
$ chmod +x agent
</code></pre></div></div>

<p>We now have to download the proxy with the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget https://github.com/nicocha30/ligolo-ng/releases/download/v0.6.1/ligolo-ng_proxy_0.6.1_linux_amd64.tar.gz
$ tar xf ./ligolo-ng_proxy_0.6.1_linux_amd64.tar.gz
</code></pre></div></div>

<p>To start my proxy server I will run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./proxy -selfcert
</code></pre></div></div>

<p>To test my Piâ€™s connection back to my PC I will run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./agent -connect 192.168.254.147:11601 -ignore-cert 
</code></pre></div></div>

<p>We can now see the connection made by the Pi:</p>

<p><img src="/assets/images/prxysession.png" alt="" /></p>

<h2 id="using-the-cloud">Using the Cloud</h2>

<p>Since our attacker machine will sit behind a firewall, we need a way to ensure that the agent can route to a cloud instance.</p>

<p><img src="/assets/images/SSH%20Tunnel.png" alt="" /></p>

<p>To make it easy and secure, we are going to route the Ligolo-ng through an SSH tunnel.</p>

<h3 id="raspberry-pi">Raspberry Pi:</h3>

<p>I created a script that will automatically create this service for you. You can find it at:
https://github.com/Cleck777/PI-Ligolo-ng-Service-Starter</p>

<p>The main component of this script is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ autossh -M 20000 -N -T -L 11601:127.0.0.1:11601 {SSH_USER}@{HOSTNAME} -i {IDENTITY_FILE}
</code></pre></div></div>

<p>This will forward your local port (default: 11601) to the remote server.</p>

<p>You can now start the agent:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ /usr/bin/agent -connect localhost:11601 -ignore-cert
</code></pre></div></div>

<h3 id="attacker-machine">Attacker Machine</h3>

<p>First, you have to start a remote port forward to your local ligolo-ng proxy:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ ssh -R 11601:127.0.0.1:11601 {SSH_USER}@{HOSTNAME} -i {IDENTITY_FILE}
</code></pre></div></div>

<p>You can now start the proxy:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ ./proxy -selfcert
</code></pre></div></div>

<p><img src="/assets/images/Ligoloconnection.png" alt="" /></p>

<p>As we can see, we get a connection from our Raspberry Pi.</p>

<p>Type <code class="language-plaintext highlighter-rouge">session</code> and choose your session.</p>

<p>Now we need to create our interface:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ sudo ip tuntap add user [your_username] mode tun ligolo
 $ sudo ip link set ligolo up
</code></pre></div></div>

<p>We can now set up our route as normal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo ip route add 192.168.0.0/24 dev ligolo
</code></pre></div></div>

<p>You can now start your agent by typing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ [Agent : root@raspberrypi] Â» start
</code></pre></div></div>

<p>And youâ€™re good to go!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#ethical-hacking" class="page__taxonomy-item p-category" rel="tag">ethical hacking</a><span class="sep">, </span>
    
      <a href="/tags/#pentesting" class="page__taxonomy-item p-category" rel="tag">pentesting</a><span class="sep">, </span>
    
      <a href="/tags/#tools" class="page__taxonomy-item p-category" rel="tag">tools</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#pentesting" class="page__taxonomy-item p-category" rel="tag">pentesting</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2024-06-24T00:00:00-04:00">June 24, 2024</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=EvilPI%3A+Using+a+Raspberry+Pi+as+an+Agent+into+an+Internal+Network%20%2Fpentesting%2FEvilPI%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2Fpentesting%2FEvilPI%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=/pentesting/EvilPI/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/pentesting/SlivervsWindows/" class="pagination--pager" title="Breaking into Windows: Attempting to bypass EDR with Sliver
">Previous</a>
    
    
      <a href="/iot/IOTUart/" class="pagination--pager" title="UART Basics: Getting a shell via UART (Netgear WNR1000v3)
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/router.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/iot/IOTUart/" rel="permalink">UART Basics: Getting a shell via UART (Netgear WNR1000v3)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Ever wonder whatâ€™s under the hood of many of your IoT devices? Itâ€™s probably some form of Linux! In this article, I will show you how to get a shell within a...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/BrokenWindows.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/pentesting/SlivervsWindows/" rel="permalink">Breaking into Windows: Attempting to bypass EDR with Sliver
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">How well does Microsoft Defender defend against a modified Sliver implant? I intend to answer that question by using common techniques used to bypass EDR to ...</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 <a href=""></a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>









  </body>
</html>
